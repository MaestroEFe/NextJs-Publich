(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{8779:function(e,t,a){Promise.resolve().then(a.bind(a,2671))},2671:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var s=a(5979),n=a(8584),l=a(9182),r=a(917),i=()=>{let[e,t]=(0,n.useState)({company:"",jobTitle:"",phone:"",tags:""}),[a,l]=(0,n.useState)(!0),[r,i]=(0,n.useState)(""),[o,d]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/crm/contacts");if(e.ok){let a=await e.json();a&&t({company:a.company||"",jobTitle:a.jobTitle||"",phone:a.phone||"",tags:(a.tags||[]).join(", ")})}}catch(e){d("Failed to load CRM data.")}finally{l(!1)}})()},[]);let c=e=>{let{name:a,value:s}=e.target;t(e=>({...e,[a]:s}))},m=async t=>{t.preventDefault(),d(""),i("");let a={...e,tags:e.tags.split(",").map(e=>e.trim()).filter(Boolean)};try{let e=await fetch("/api/crm/contacts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(e.ok)i("CRM details updated successfully!");else{let t=await e.json();d(t.message||"Failed to update CRM details.")}}catch(e){d("Something went wrong!")}};return a?(0,s.jsx)("p",{children:"Loading CRM details..."}):(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md mt-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"CRM Details"}),(0,s.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"company",children:"Company"}),(0,s.jsx)("input",{type:"text",name:"company",value:e.company,onChange:c,className:"w-full p-2 border border-gray-300 rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"jobTitle",children:"Job Title"}),(0,s.jsx)("input",{type:"text",name:"jobTitle",value:e.jobTitle,onChange:c,className:"w-full p-2 border border-gray-300 rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"phone",children:"Phone"}),(0,s.jsx)("input",{type:"text",name:"phone",value:e.phone,onChange:c,className:"w-full p-2 border border-gray-300 rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"tags",children:"Tags (comma-separated)"}),(0,s.jsx)("input",{type:"text",name:"tags",value:e.tags,onChange:c,className:"w-full p-2 border border-gray-300 rounded"})]}),o&&(0,s.jsx)("p",{className:"text-red-500",children:o}),r&&(0,s.jsx)("p",{className:"text-green-500",children:r}),(0,s.jsx)("button",{type:"submit",className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"Update CRM Details"})]})]})},o=()=>{var e;let{data:t,update:a}=(0,l.useSession)(),[o,d]=(0,n.useState)(""),[c,m]=(0,n.useState)(""),[u,h]=(0,n.useState)(null),[p,g]=(0,n.useState)(""),[x,b]=(0,n.useState)("");(0,n.useEffect)(()=>{if(t){var e,a;d((null===(e=t.user)||void 0===e?void 0:e.name)||""),m((null===(a=t.user)||void 0===a?void 0:a.email)||"")}},[t]);let j=async e=>{e.preventDefault(),b(""),g(""),h(null);let s=r.gV.safeParse({name:o,email:c});if(!s.success){h(s.error);return}try{let e=await fetch("/api/user",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s.data)}),n=await e.json();e.ok?(g(n.message),await a({...t,user:{...null==t?void 0:t.user,...s.data}})):b(n.message||"Something went wrong!")}catch(e){b("Something went wrong!")}};return(0,s.jsxs)("div",{className:"container mx-auto p-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Profile"}),t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:(0,s.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"name",children:"Name"}),(0,s.jsx)("input",{type:"text",id:"name",value:o,onChange:e=>d(e.target.value),className:"w-full p-2 border border-gray-300 rounded"}),(null==u?void 0:u.flatten().fieldErrors.name)&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:u.flatten().fieldErrors.name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",children:"Email"}),(0,s.jsx)("input",{type:"email",id:"email",value:c,onChange:e=>m(e.target.value),className:"w-full p-2 border border-gray-300 rounded"}),(null==u?void 0:u.flatten().fieldErrors.email)&&(0,s.jsx)("p",{className:"text-red-500 text-sm",children:u.flatten().fieldErrors.email})]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Role:"})," ",null===(e=t.user)||void 0===e?void 0:e.group]}),x&&(0,s.jsx)("p",{className:"text-red-500",children:x}),p&&(0,s.jsx)("p",{className:"text-green-500",children:p}),(0,s.jsx)("button",{type:"submit",className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"Update Profile"})]})}),(0,s.jsx)(i,{})]}):(0,s.jsx)("p",{children:"Loading session..."})]})}},917:function(e,t,a){"use strict";a.d(t,{dm:function(){return l},gY:function(){return n},S4:function(){return i},gV:function(){return r}});var s=a(1883);let n=s.z.object({name:s.z.string().min(3,{message:"Name must be at least 3 characters long"}),email:s.z.string().email({message:"Invalid email address"}),password:s.z.string().min(6,{message:"Password must be at least 6 characters long"})}),l=s.z.object({email:s.z.string().email({message:"Invalid email address"}),password:s.z.string().min(1,{message:"Password is required"})}),r=s.z.object({name:s.z.string().min(3).optional(),email:s.z.string().email().optional()}),i=s.z.object({password:s.z.string().min(6,{message:"Password must be at least 6 characters long"})})}},function(e){e.O(0,[883,182,232,922,744],function(){return e(e.s=8779)}),_N_E=e.O()}]);